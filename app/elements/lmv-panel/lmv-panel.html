<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="lmv-panel">

  <!-- CSS Rules -->
  <link rel="import" type="css" href="lmv-panel.css">

  <!-- Local DOM -->
  <template>
    <div id="header" on-track="_onDrag">
      <span class="header">{{header}}</span>
      <iron-icon class="icon" icon="expand-more" on-click="toggleCollapse"></iron-icon>
      <iron-icon class="icon" icon="close" on-click="close"></iron-icon>
    </div>
    <div id="content" hidden$="[[collapse]]">
      <content></content>
    </div>
  </template>

</dom-module>

<!-- Polymer Script -->
<script>
(function() {
  LMVUI.Panel = Polymer({
    is: "lmv-panel",

    properties: {
      header: {
        type: String,
        value: "Header",
        reflectToAttribute: true,
      },
      collapse: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
      },
      _dragged: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
      },
    },

    factoryImpl: function(header) {
      this.header = header || this.header;
    },

    toggleCollapse: function() {
      this.collapse = !this.collapse;
    },

    close: function() {
      Polymer.dom(this.parentNode).removeChild(this);
    },

    _onDrag: function(e) {
      switch(e.detail.state) {
        case "start":
          var rect = this.getBoundingClientRect();
          this._dragged = true;
          this._top = rect.top;
          this._left = rect.left;
          break;
        case "track":
          // update pos
          this._top += e.detail.ddy;
          this._left += e.detail.ddx;
          // check bounds
          var BOUNDS_PAD = 50;  // don't want to do getBoundingClientRect every frame
          this._top = Math.max(Math.min(this._top, window.innerHeight-BOUNDS_PAD), 0.0);
          this._left = Math.max(Math.min(this._left, window.innerWidth-BOUNDS_PAD), 0.0);
          // update css
          this.style.top = this._top + "px";
          this.style.left = this._left + "px";
          break;
      }
    },

  });
})();
</script>